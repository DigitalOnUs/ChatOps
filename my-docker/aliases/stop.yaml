#packs/my-chatops/aliases/docker/stop.yaml
---
name: 'stop'
pack: 'my-docker'
action_ref: 'my-docker.docker'
description: 'Execute docker stop on remote host via SSH.'
formats:
  - display: 'docker stop container name:<container> options:<options|optional> on <host>'
    representation:
      - '.*docker.*stop.*containers?.*name ?(:|is|as|=|-)? ?{{container_name}} .* options ?(:|is|=|-|as)? ?"?{{options}}"? .*(on|for|from) {{hosts}} .*{{sub_cmd=stop}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}'
      - '.*stop.*docker.*containers?.*name ?(:|is|as|=|-)? ?{{container_name}} .* options ?(:|is|=|-|as)? ?"?{{options}}"? .*(on|for|from) {{hosts}} .*{{sub_cmd=stop}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}'
      - ".*stop.*docker.*containers?.*name ?(:|is|=|-|as)? ?{{container_name}} .*(on|for|from) {{hosts}} .* {{sub_cmd=stop}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}"
      - '.*docker.*stop.*containers?.*name ?(:|is|=|-|as)? ?{{container_name}} .*(on|for|from) {{hosts}} .* {{sub_cmd=stop}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}'  
      #Stop ALL
      - ".*stop.*all.*docker.*containers?.*(on|for|from) {{hosts}} .* {{sub_cmd=stop $(docker ps -a -q)}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}"
      - '.*docker.*stop.*all.*containers?.*(on|for|from) {{hosts}} .* {{sub_cmd=stop $(docker ps -a -q)}} {{private_key=/home/ubuntu/aws_keys/Hum_do.pem}} {{username=ubuntu}}'      
result:
  format: |
   Status : {{ execution.status }}

   Results:
   {% if execution.status == "succeeded" %}
        {% for host in execution.result %}
           Host: *{{host}}*
           ---> stdout:
               {{execution.result[host].stdout}}
           ---> stderr:
               {{execution.result[host].stderr}}
        {% endfor %}
   {% else %}
      {{ execution.result }}
   {% endif %}
